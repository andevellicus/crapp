{{ define "header" }}
<header>
    <div class="header-main">
        <h1>CRAPP</h1>
        <h2>Cognitive Reporting Application</h2>
    </div>
    
    <nav class="main-nav">
        <div class="nav-links">
            <a href="/">Home</a>
            <!-- Only show visualization link for admins -->
            <span id="admin-links" style="display: none">
                <a href="/admin/users">Manage Users</a>
            </span>
        </div>
        
        <div class="auth-nav">
            <!-- This part will be shown for logged-in users -->
            <div class="user-menu" id="user-menu" style="display: none;">
                <div class="user-menu-trigger">
                    <span id="user-name">User Name</span>
                    <span class="dropdown-arrow">â–¼</span>
                </div>
                <div class="user-dropdown">
                    <a href="/profile">Profile</a>
                    <a href="/devices">My Devices</a>
                    <a href="#" class="logout-button">Logout</a>
                </div>
            </div>
            
            <!-- This part will be shown for anonymous users -->
            <div class="guest-nav" id="guest-nav">
                <a href="/login" class="nav-button">Login</a>
                <a href="/register" class="nav-button highlight">Register</a>
            </div>
        </div>
    </nav>
</header>

<script>
    // Update the header based on auth status
    document.addEventListener('DOMContentLoaded', function() {
        const userMenu = document.getElementById('user-menu');
        const guestNav = document.getElementById('guest-nav');
        const userName = document.getElementById('user-name');
        const adminLinks = document.getElementById('admin-links');

        // Show admin links if user is admin -- DEPRECATED?
        //         //if (CRAPP.auth.getCurrentUser().is_admin) {
        //    document.getElementById('admin-links').style.display = 'inline';
        //}
        
        if (CRAPP.auth.isAuthenticated()) {
            // User is logged in
            if (userMenu) userMenu.style.display = 'block';
            if (guestNav) guestNav.style.display = 'none';
            
            // Update user name
            const user = CRAPP.auth.getCurrentUser() || 
                       JSON.parse(localStorage.getItem('currentUser') || 
                       sessionStorage.getItem('currentUser') || '{}');
                       
            if (userName && user) {
                userName.textContent = user.first_name || user.email;
            }
            
            // Show admin links if user is admin
            if (adminLinks && user && user.is_admin) {
                adminLinks.style.display = 'inline';
            }
            
            // Setup dropdown toggle
            const trigger = document.querySelector('.user-menu-trigger');
            const dropdown = document.querySelector('.user-dropdown');
            
            if (trigger && dropdown) {
                trigger.addEventListener('click', function() {
                    dropdown.classList.toggle('show');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    if (!trigger.contains(event.target) && !dropdown.contains(event.target)) {
                        dropdown.classList.remove('show');
                    }
                });
            }
        } else {
            // User is not logged in
            if (userMenu) userMenu.style.display = 'none';
            if (guestNav) guestNav.style.display = 'flex';
        }
    });
</script>
{{ end }}